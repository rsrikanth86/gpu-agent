# This container provides a development environment with all necessary 
# compilation and development tools pre-installed.
ARG BUILD_BASE_IMAGE=registry.access.redhat.com/ubi9/ubi:9.4
FROM ${BUILD_BASE_IMAGE}

LABEL maintainer="praveenkumar.shanmugam@amd.com"

# Install build dependencies
WORKDIR /usr/src/github.com/Rocm/gpu-agent/

RUN dnf install -y --allowerasing \
    git \
    gcc \
    gcc-c++ \
    make \
    automake \
    libtool \
    curl \
    unzip \
    which \
    cmake \
    autoconf \
    glibc-static \
    libstdc++-static \
    wget \
    yum \
    && dnf clean all

RUN yum install -y sudo

RUN wget https://go.dev/dl/go1.24.4.linux-amd64.tar.gz && \
    tar -C /usr/local -xzf go1.24.4.linux-amd64.tar.gz && \
    rm -f go1.24.4.linux-amd64.tar.gz

ENV PATH=$PATH:/usr/local/go/bin:/root/go/bin
ENV LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
ENV PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH
  
ADD ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
