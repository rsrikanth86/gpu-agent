# This container provides a development environment with all necessary 
# compilation and development tools pre-installed.
ARG BUILD_BASE_IMAGE=ubuntu:22.04
FROM ${BUILD_BASE_IMAGE}

LABEL maintainer="praveenkumar.shanmugam@amd.com"

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# remove old version of go
RUN rm -rf /usr/local/go

RUN apt-get update && apt-get install -y wget protobuf-compiler \
    curl locales ca-certificates build-essential git vim \
    autoconf automake libtool pkg-config \
    net-tools sudo cmake build-essential jq && \
    install -m 0755 -d /etc/apt/keyrings && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

RUN localedef -i en_US -f UTF-8 en_US.UTF-8

# Install build dependencies
RUN apt-get update && apt-get install -y \
  make python3-sphinx python3-pip \
  git && apt-get clean && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/github.com/Rocm/gpu-agent/

RUN wget https://go.dev/dl/go1.24.4.linux-amd64.tar.gz && \
    tar -C /usr/local -xzf go1.24.4.linux-amd64.tar.gz && \
    rm -f go1.24.4.linux-amd64.tar.gz

ADD ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
